<div class="row modern-page">
  <div class="col-sm-12">
    <div class="card modern-card">
      <div class="card-body">

      <div class="section-card page-hero mb-3">
        <div class="hero-content">
          <div class="hero-left">
            <i class="feather icon-activity"></i>
            <div>
              <div class="hero-title">Action History</div>
              <div class="hero-subtitle">Filter and review past actions by users.</div>
            </div>
          </div>
        </div>
      </div>

      <form [formGroup]="filterForm" class="form-modern section-card mb-3">
        <div class="row g-3 align-items-end">
          <div class="col-md-3">
            <label class="form-label" for="startDate">Start date</label>
            <input id="startDate" type="date" class="form-control" formControlName="startDate" />
          </div>
          <div class="col-md-3">
            <label class="form-label" for="endDate">End date</label>
            <input id="endDate" type="date" class="form-control" formControlName="endDate" />
          </div>
          <div class="col-md-2">
            <label class="form-label" for="cq">CQ</label>
            <input id="cq" type="number" class="form-control" formControlName="cq" />
          </div>
          <div class="col-md-3">
            <label class="form-label" for="userId">User</label>
            <select id="userId" class="form-control" formControlName="userId">
              <option value="">-- All --</option>
              <option *ngFor="let u of users" [value]="u.id">{{ u.nomUser }}</option>
            </select>
          </div>
          <div class="col-md-12">
            <div class="form-actions center">
              <button type="button" class="btn btn-add-user" (click)="applyFilter()">
                <i class="feather icon-filter"></i>
                <span>Filter</span>
              </button>
              <button type="button" class="btn btn-outline-secondary" (click)="resetFilters()">
                <i class="feather icon-refresh-ccw"></i> Reset
              </button>
            </div>
          </div>
        </div>
      </form>

      <div *ngIf="loading" class="alert alert-info">Loading...</div>
      <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

      <div class="section-card" *ngIf="!loading && actions.length > 0">
        <div class="table-responsive">
        <table class="table-modern">
          <thead>
            <tr>
              <th>Date</th>
              <th>User</th>
              <th>Type</th>
              <th>Target</th>
              <th>Reference</th>
              <th>Details</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let a of (actions | slice: (page - 1) * pageSize : (page - 1) * pageSize + pageSize); trackBy: trackById">
              <td>{{ formatDate(a.dateAction) }}</td>
              <td>{{ a.userName }}</td>
              <td>{{ a.type }}</td>
              <td>{{ a.cibleAction }}</td>
              <td>{{ a.referenceCible }}</td>
              <td>{{ a.detailsAction }}</td>
            </tr>
          </tbody>
        </table>
        </div>
        <div class="d-flex justify-content-between align-items-center mt-3">
          <small class="text-muted">Showing {{ startIndex }}-{{ endIndex }} of {{ actions.length }}</small>
          <ngb-pagination
            [(page)]="page"
            [pageSize]="pageSize"
            [collectionSize]="actions.length"
            [boundaryLinks]="true"
            [maxSize]="5"
            size="sm">
          </ngb-pagination>
        </div>
      </div>
      <p *ngIf="!loading && actions.length === 0" class="text-muted">No actions found.</p>
      </div>
    </div>
  </div>
</div>