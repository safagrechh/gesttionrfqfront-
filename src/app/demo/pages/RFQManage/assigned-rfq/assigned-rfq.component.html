<div class="row">
  <div class="col-12">
    <div class="card modern-card">
      <div class="card-body">
        <!-- Page Hero -->
        <div class="section-card page-hero">
          <div class="hero-content">
            <div class="hero-left">
              <i class="feather icon-user-check"></i>
              <div>
                <div class="hero-title">Assigned RFQs</div>
                <div class="hero-subtitle">Review RFQs assigned to you and manage their status.</div>
              </div>
            </div>
            <div class="hero-actions">
              <!-- No primary action button here; filters are below -->
            </div>
          </div>
        </div>
        <div class="d-flex align-items-center justify-content-end mb-3 flex-wrap gap-2">
          <div class="d-flex align-items-center gap-3">
            <div class="status-toggle segmented" role="group" aria-label="Filter by status">
              <button type="button" class="toggle-btn all" [class.active]="filterStatus==='all'" (click)="filterStatus='all'; applyFilter()">
                <i class="feather icon-grid"></i>
                <span>All</span>
                <span class="count">{{ countAll }}</span>
              </button>
              <button type="button" class="toggle-btn pending" [class.active]="filterStatus==='pending'" (click)="filterStatus='pending'; applyFilter()">
                <i class="feather icon-clock"></i>
                <span>Pending</span>
                <span class="count">{{ countPending }}</span>
              </button>
              <button type="button" class="toggle-btn validated" [class.active]="filterStatus==='validated'" (click)="filterStatus='validated'; applyFilter()">
                <i class="feather icon-check-circle"></i>
                <span>Validated</span>
                <span class="count">{{ countValidated }}</span>
              </button>
              <button *ngIf="isEngineer" type="button" class="toggle-btn draft" [class.active]="filterStatus==='draft'" (click)="filterStatus='draft'; applyFilter()">
                <i class="feather icon-file-text"></i>
                <span>Draft</span>
                <span class="count">{{ countDraft }}</span>
              </button>
            </div>
            <div class="modern-search unified" style="max-width: 360px;">
              <i class="feather icon-search"></i>
              <input type="text" class="form-control" placeholder="Search RFQs by id, CQ, quote, client" [(ngModel)]="searchText" (input)="applyFilter()">
            </div>
          </div>
        </div>

        <div *ngIf="filtered.length === 0" class="text-center py-5 text-muted">
          <i class="feather icon-inbox display-6"></i>
          <p class="mt-2">No assigned RFQs found.</p>
        </div>

        <div class="row g-3" *ngIf="filtered.length > 0">
          <div class="col-xl-3 col-lg-4 col-md-6" *ngFor="let rfq of paged">
            <div class="rfq-card h-100" [class.is-draft]="rfq.brouillon">
              <span *ngIf="rfq.brouillon" class="draft-ribbon">Draft</span>
              <div class="rfq-card-header d-flex align-items-center justify-content-between">
                <span class="badge bg-primary" *ngIf="!rfq.brouillon">RFQ N°{{ rfq.id }}</span>
                <span *ngIf="!rfq.brouillon" class="badge" [ngClass]="{
                  'bg-success': rfq.valide === true && rfq.rejete !== true,
                  'bg-danger': rfq.rejete === true,
                  'bg-warning text-dark': rfq.valide !== true && rfq.rejete !== true
                }">
                  {{ rfq.rejete ? 'Rejected' : (rfq.valide ? 'Validated' : 'Pending') }}
                </span>
              </div>
              <div class="rfq-card-body">
                <h6 class="rfq-title mb-2">{{ rfq.quoteName || 'No quote name provided' }}</h6>
                <div class="rfq-meta">
                  <div><i class="feather icon-user me-1"></i> {{ rfq.client || 'Unknown Client' }}</div>
                  <div><i class="feather icon-hash me-1"></i> CQ: {{ rfq.cq ?? '—' }}</div>
                  <div><i class="feather icon-layers me-1"></i> Versions: {{ rfq.versionsCount ?? 0 }}</div>
                </div>
              </div>
              <div class="rfq-card-actions d-flex justify-content-end align-items-center gap-2">
                <a class="icon-btn view" [routerLink]="'/rfq-manage/get-rfq/' + rfq.id" title="View RFQ">
                  <i class="feather icon-eye"></i>
                </a>
                <a class="icon-btn edit" *ngIf="isEngineer" [routerLink]="'/rfq-manage/edit-rfq/' + rfq.id" title="Edit RFQ">
                  <i class="feather icon-edit"></i>
                </a>
                <span *ngIf="rfq.brouillon" class="draft-watermark">DRAFT</span>
              </div>
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-center assigned-pagination" *ngIf="filtered.length > pageSize">
          <ngb-pagination
            class="pagination-dark"
            [collectionSize]="filtered.length"
            [(page)]="page"
            [pageSize]="pageSize"
            size="sm">
          </ngb-pagination>
        </div>
      </div>
    </div>
  </div>
</div>
