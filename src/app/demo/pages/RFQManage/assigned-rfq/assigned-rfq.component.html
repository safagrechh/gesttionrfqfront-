<div class="row">
  <div class="col-12">
    <div class="card modern-card">
      <div class="card-body">
        <div class="d-flex align-items-center justify-content-between mb-3 flex-wrap gap-2">
          <h5 class="mb-0">Assigned RFQs</h5>
          <div class="d-flex align-items-center gap-3">
            <div class="btn-group status-toggle" role="group" aria-label="Filter by status">
              <button type="button" class="btn btn-sm" [class.active]="filterStatus==='all'" (click)="filterStatus='all'; applyFilter()">
                All <span class="badge bg-light text-dark ms-1">{{ countAll }}</span>
              </button>
              <button type="button" class="btn btn-sm btn-pending" [class.active]="filterStatus==='pending'" (click)="filterStatus='pending'; applyFilter()">
                Pending <span class="badge bg-light text-dark ms-1">{{ countPending }}</span>
              </button>
              <button type="button" class="btn btn-sm btn-validated" [class.active]="filterStatus==='validated'" (click)="filterStatus='validated'; applyFilter()">
                Validated <span class="badge bg-light text-dark ms-1">{{ countValidated }}</span>
              </button>
              <button *ngIf="isEngineer" type="button" class="btn btn-sm" [class.active]="filterStatus==='draft'" (click)="filterStatus='draft'; applyFilter()">
                Draft <span class="badge bg-light text-dark ms-1">{{ countDraft }}</span>
              </button>
            </div>
            <div class="modern-search unified" style="max-width: 360px;">
              <i class="feather icon-search"></i>
              <input type="text" class="form-control" placeholder="Search RFQs by id, CQ, quote, client" [(ngModel)]="searchText" (input)="applyFilter()">
            </div>
          </div>
        </div>

        <div *ngIf="filtered.length === 0" class="text-center py-5 text-muted">
          <i class="feather icon-inbox display-6"></i>
          <p class="mt-2">No assigned RFQs found.</p>
        </div>

        <div class="row g-3" *ngIf="filtered.length > 0">
          <div class="col-xl-3 col-lg-4 col-md-6" *ngFor="let rfq of paged">
            <div class="rfq-card h-100" [class.is-draft]="rfq.brouillon">
              <span *ngIf="rfq.brouillon" class="draft-ribbon">Draft</span>
              <div class="rfq-card-header d-flex align-items-center justify-content-between">
                <span class="badge bg-primary">RFQ N°{{ rfq.id }}</span>
                <span *ngIf="!rfq.brouillon" class="badge" [ngClass]="{
                  'bg-success': rfq.valide === true && rfq.rejete !== true,
                  'bg-danger': rfq.rejete === true,
                  'bg-warning text-dark': rfq.valide !== true && rfq.rejete !== true
                }">
                  {{ rfq.rejete ? 'Rejected' : (rfq.valide ? 'Validated' : 'Pending') }}
                </span>
              </div>
              <div class="rfq-card-body">
                <h6 class="rfq-title mb-2">{{ rfq.quoteName || 'No quote name provided' }}</h6>
                <div class="rfq-meta">
                  <div><i class="feather icon-user me-1"></i> {{ rfq.client || 'Unknown Client' }}</div>
                  <div><i class="feather icon-hash me-1"></i> CQ: {{ rfq.cq ?? '—' }}</div>
                  <div><i class="feather icon-layers me-1"></i> Versions: {{ rfq.versionsCount ?? 0 }}</div>
                </div>
              </div>
              <div class="rfq-card-actions d-flex justify-content-between align-items-center">
                <a [routerLink]="'/rfq-manage/get-rfq/' + rfq.id" class="btn btn-sm btn-outline-primary">
                  <i class="feather icon-eye me-1"></i> View
                </a>
                <a *ngIf="isEngineer" [routerLink]="'/rfq-manage/edit-rfq/' + rfq.id" class="btn btn-sm btn-primary">
                  <i class="feather icon-edit me-1"></i> Edit
                </a>
              <span *ngIf="rfq.brouillon" class="draft-watermark">DRAFT</span>
            </div>
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-center mt-3" *ngIf="filtered.length > pageSize">
          <ngb-pagination
            class="pagination-dark"
            [collectionSize]="filtered.length"
            [(page)]="page"
            [pageSize]="pageSize"
            size="sm">
          </ngb-pagination>
        </div>
      </div>
    </div>
  </div>
</div>